{{- $lang := .Type | default "" -}}
{{- $code := .Inner -}}

{{- $chapterID := replace .Page.File.Path "\\" "/" -}}
{{- $mapKey := printf "CHAPTER2DECK::%s" $chapterID -}}
{{- $deckID := hugo.Store.Get $mapKey -}}

{{- $flag := false -}}
{{- if $deckID -}}
  {{- $flagKey := printf "RENDERING_SLIDES::%s" $deckID -}}
  {{- $flag = hugo.Store.Get $flagKey -}}
{{- end -}}

{{- if $flag -}}
  {{- $class := "" -}}
  {{- with $lang -}}
    {{- $class = printf ` class="language-%s"` . -}}
  {{- end -}}
  {{- printf "<pre><code%s>%s</code></pre>" $class ($code | htmlEscape) | safeHTML -}}
{{- else -}}
  {{- highlight $code $lang "" -}}
{{- end -}}
